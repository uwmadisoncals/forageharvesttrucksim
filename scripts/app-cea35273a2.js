!function(){"use strict";angular.module("trucksim",["ui.bootstrap","ui.router","toastr"]).config(["$logProvider","toastrConfig",function(t,a){t.debugEnabled(!0),a.allowHtml=!0,a.timeOut=3e3,a.positionClass="toast-top-right",a.preventDuplicates=!0,a.progressBar=!0}]).directive(function(){function t(t){var a=this;a.relativeDate=t(a.creationDate).fromNow()}t.$inject=["moment"];var a={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:t,controllerAs:"vm",bindToController:!0};return a}).config(["$stateProvider","$urlRouterProvider",function(t,a){a.otherwise("/home"),t.state("home",{url:"/home",templateUrl:"template/home.html"}).state("/observed",{url:"/observed",templateUrl:"template/observed.html"})}]).factory("colors",["ACTIONS",function(t){var a={};return a[t.LOADING]="#1FC01F",a[t.WAIT]="#C01F1F",a[t.FIELD_EMPTY]="#728C72",a[t.FIELD_LOADED]=a[t.FIELD_EMPTY],a[t.ROAD_EMPTY]="#D9822A",a[t.ROAD_LOADED]=a[t.ROAD_EMPTY],a[t.UNLOAD]="#2A2AD9",a[t.READY]="#FFFFFF",a}])}(),angular.module("trucksim").constant("ACTIONS",{LOADING:"loading",WAIT:"wait",FIELD_EMPTY:"field_travel1",ROAD_EMPTY:"road1",FIELD_LOADED:"field_travel2",ROAD_LOADED:"road2",UNLOAD:"unload",READY:"ready",HOLD:"onHold"}).factory("HarvestSimulator",["ACTIONS","$injector",function(t,a){function n(t,a,n){var i=this;i.field=angular.copy(n),i.tonsHarvested=0,i.harvester=angular.copy(t),i.trucks=a.map(function(t){return angular.copy(t)}),i.machines=[i.harvester].concat(i.trucks),i.machines.forEach(function(t){t.actionLog=[]})}return n.prototype.summarize=function(){var a=this,n=0,i=[];a.machines.forEach(function(a){var o={tonnes:0,loadingSec:0,waitingSec:0,loads:0};a.actionLog.forEach(function(a){a.action===t.LOADING?(o.tonnes+=a.tonnes,o.loads++,o.loadingSec+=a.duration):a.action===t.WAIT&&(o.waitingSec+=a.duration,n+=a.duration)}),o.totalTime=o.loadingSec+o.waitingSec,o.utilization=o.loadingSec/o.totalTime,o.effectiveThroughput=o.tonnes/o.totalTime*3600,i.push(o)});var o={harvester:i.shift(),trucks:i};return o.truckWaitSecs=n-o.harvester.waitingSec,o},n.prototype.run=function(){var a=this,n=0,i=a.harvester;i.state={action:t.WAIT,start:0},i.rate=a.harvester.capacity/3600,a.trucks.forEach(function(a){angular.isUndefined(a.state)&&(a.state={action:t.READY,start:0})});for(var o=function(t,a,i){t.state.duration=n-t.state.start,angular.extend(t.state,i),t.state.duration>0&&t.actionLog.push(t.state),t.state={action:a,start:n}},r=function(t){return n-t.state.start>a.field.travel/t.field*3600},e=function(t){return n-t.state.start>a.field.haul/t.road*3600},c=function(t){return n-t.state.start>t.unload},s=function(n){for(var i=a.trucks.length;i--;){var o=a.trucks[i];if(angular.isDefined(o)&&o.capacity<n.capacity&&o.state.action===t.WAIT)return!0}},d=function(t){return t.current_load<t.capacity*a.field.minPartial?!1:s(t)};a.tonsHarvested<a.field.tonnes;)a.trucks.forEach(function(n,u){n.state.action===t.FIELD_EMPTY&&r(n)&&o(n,t.WAIT),n.state.action!==t.WAIT&&n.state.action!==t.READY||i.state.action!==t.WAIT||(o(n,t.LOADING),o(i,t.LOADING),n.current_load=0),n.state.action===t.HOLD&&i.state.action===t.WAIT&&(o(i,t.LOADING),n.state.action=t.LOADING),n.state.action===t.LOADING&&(n.current_load+=i.rate,a.tonsHarvested+=i.rate,(n.current_load>n.capacity||a.field.sendPartials&&d(n))&&(o(n,t.FIELD_LOADED,{tonnes:n.current_load}),o(i,t.WAIT,{tonnes:n.current_load})),a.field.holdTrucks&&s(n)&&(o(i,t.WAIT,{tonnes:n.current_load}),n.state.action=t.HOLD)),n.state.action===t.FIELD_LOADED&&r(n)&&o(n,t.ROAD_LOADED),n.state.action===t.ROAD_LOADED&&e(n)&&o(n,t.UNLOAD),n.state.action===t.UNLOAD&&c(n)&&o(n,t.ROAD_EMPTY),n.state.action===t.ROAD_EMPTY&&e(n)&&o(n,t.FIELD_EMPTY),n.state.action===t.FIELD_EMPTY&&r(n)&&o(n,t.WAIT)}),n++;return a.trucks.forEach(function(a){a.state.action===t.LOADING&&(o(a,t.FIELD_LOADED,{tonnes:a.current_load}),o(i,t.WAIT,{tonnes:a.current_load}))}),a.summary=a.summarize(),a.machines},n.prototype.fromJson=function(t){var n=angular.fromJson(a.get(t)),i={};angular.forEach(n,function(t,a){i.label=a,i.actionLog=t})},n}]),angular.module("trucksim").directive("script",["$templateCache","$templateRequest",function(t,a){return{restrict:"E",terminal:!0,compile:function(n,i){if("text/ng-template"===i.type&&i.src&&!i.id){var o=i.root||"";a(o+i.src).then(function(a){t.put(i.src,a)})}}}}]),angular.module("trucksim").controller("simulationCtrl",["$scope","$timeout","HarvestSimulator",function(t,a,n){var i=function(){var i=new n(t.chopper,t.trucks,t.field);t.chartMeta.data=i.run(),t.summary=i.summary,a(function(){t.chart.refresh()})};i(),t.update=i,t.$watchCollection("chopper",i),t.$watch("trucks",i,!0),t.$watchCollection("field",i)}]),angular.module("trucksim").controller("observationCtrl",["$scope","$http","$timeout","$compile","$interpolate","$templateCache","ACTIONS",function(t,a,n,i,o,r,e){t.fields=[7,34,289],t.observe={field:localStorage.getItem("observeField")||t.fields[0]},t.chartMeta.tooltip=function(a,i){return i.mergeLeft=function(){var a=i.actionLog.indexOf(i.data)-1,o=i.actionLog.splice(a,1)[0];i.data.duration+=o.duration,i.data.start-=o.duration,i.hideTooltip(),n(function(){t.chart.refresh()})},i.mergeRight=function(){var a=i.actionLog.indexOf(i.data)+1,o=i.actionLog.splice(a,1)[0];i.data.duration+=o.duration,i.hideTooltip(),n(function(){t.chart.refresh()})},i.remove=function(){i.actionLog.splice(i.actionLog.indexOf(i.data),1),t.chartMeta.data.forEach(function(t){var a=[];t.actionLog.forEach(function(t){t.start>=i.data.start+i.data.duration?t.start-=i.data.duration:t.start>=i.data.start?t.start+t.duration>=i.data.start+i.data.duration?(t.duration-=i.data.start+i.data.duration-t.start,t.start-=i.data.duration):a.push(t):t.start+t.duration>i.data.start&&(t.duration=i.data.start-t.start)})}),n(function(){t.chart.refresh()})},r.get("template/editTooltip.html")},t.chartMeta.dragFn=function(a,i){var o,r=this,e=r.indexOf(a),c=r.indexOf(i);0>e||0>c||e===c||(e>c?(o=r.splice(c,e-c),o.forEach(function(t){a.duration+=t.duration,a.start-=t.duration})):(o=r.splice(e+1,c-e),o.forEach(function(t){a.duration+=t.duration})),n(function(){t.chart.refresh()}))};var c={7:["4","2","5"],34:["12","9","7","8"],289:["145","144","146"]},s=function(){localStorage.setItem("observeField",t.observe.field),a.get("/json/field_"+t.observe.field+".json").then(function(a){var i=a.data,o=[{machine:"harvester",label:"Harvester",actionLog:i.harvester}];angular.forEach(i,function(t,a){"harvester"!==a&&o.push({machine:a,label:"Truck "+a,actionLog:t})});var r=c[t.observe.field]||[];o.sort(function(t,a){return"harvester"===t.machine?-1:r.indexOf(t.machine)-r.indexOf(a.machine)}),t.chartMeta.data=o,n(function(){t.chart.refresh()}),t.summary={tonnes:0,workingTime:0,trucks:[]},o.forEach(function(a){var n={tonnes:0,loadingSec:0,waitingSec:0,unloadSec:0,idleSec:0,loads:0,label:a.label};a.actionLog.forEach(function(i){n.isHarvester="harvester"===a.machine,i.action===e.LOADING?(!n.isHarvester&&i.tonnes>0&&(n.tonnes+=i.tonnes,t.summary.tonnes+=i.tonnes,t.summary.workingTime+=i.duration,n.loads++),n.loadingSec+=i.duration):i.action===e.WAIT?n.waitingSec+=i.duration:i.action===e.UNLOAD||"scale"===i.action||"taxi"===i.action?n.unloadSec+=i.duration:n.isHarvester&&(n.idleSec+=i.duration)}),n.isHarvester?t.summary.harvester=n:(n.unloadPer=n.unloadSec/n.loads,t.summary.trucks.push(n))});var s=t.summary.harvester;s.totalTime=s.loadingSec+s.waitingSec+s.idleSec,s.utilization=s.loadingSec/s.totalTime,s.tonnes=t.summary.tonnes,s.effectiveThroughput=s.tonnes/s.totalTime*3600,s.capacity=s.tonnes/t.summary.workingTime*3600})};s(),t.update=s,t.$watch("observe.field",s)}]),function(){"use strict";angular.module("trucksim").controller("mainCtrl",["$scope","$timeout","$interpolate","$templateCache","$q","ACTIONS","d3","HarvestSimulator","colors",function(t,a,n,i,o,r,e,c,s){t.ngModelOptions={debounce:{"default":500,blur:0}},t.truck_types={apron:{label:"Apron Body",capacity:14,road:48,field:20,unload:255},dump:{label:"Dump Body",capacity:14,road:47,field:20,unload:245},semi:{label:"Semi Apron",capacity:23.5,road:52,field:16,unload:233},tractor:{label:"Hi-speed Tractor",capacity:17,road:42,field:14.9,unload:386}},t.presetTruck=function(a){t.trucks[a]=angular.copy(t.trucks[a].preset)},t.presetSimulations={7:{field:{tonnes:660,haul:3.4,travel:.3,sendPartials:!1,minPartial:.5,holdTrucks:!1},chopper:{label:"Harvester",capacity:204},trucks:[{label:"Semi 4",capacity:23.1,road:52,field:16,unload:233},{label:"Semi 2",capacity:24.6,road:52,field:16,unload:233},{label:"Semi 5",capacity:23.1,road:52,field:16,unload:233}]},34:{field:{tonnes:372,haul:2.4,travel:1,sendPartials:!1,minPartial:.5,holdTrucks:!1},chopper:{label:"Harvester",capacity:182},trucks:[{label:"Apron 12",capacity:13.1,road:48,field:20,unload:185},{label:"Dump 9",capacity:11.6,road:48,field:20,unload:185},{label:"Apron 7",capacity:13.6,road:48,field:20,unload:185},{label:"Apron 8",capacity:11.3,road:48,field:20,unload:185}]},289:{field:{tonnes:1027,haul:.25,travel:.3,sendPartials:!1,minPartial:.5,holdTrucks:!1},chopper:{label:"Harvester",capacity:224},trucks:[{label:"Apron 144",capacity:14.5,road:48,field:20,unload:181},{label:"Apron 145",capacity:14.4,road:48,field:20,unload:181},{label:"Apron 146",capacity:14.4,road:48,field:20,unload:181}]}},t.selectPreset=function(a){t.trucks=a.trucks,t.field=a.field,t.chopper=a.chopper},t.field={tonnes:300,haul:4,travel:.5,sendPartials:!1,minPartial:.5,holdTrucks:!1},t.removeTruck=function(a){t.trucks.splice(a,1)},t.addTruck=function(a){t.trucks.push(angular.copy(t.truck_types[a||"apron"]))};var d=3;t.trucks=[];for(var u=0;d>u;u++)t.addTruck("semi");t.chopper={label:"Harvester",capacity:200},t.getCurrentAction=function(t,a){for(var n=a.length;n--;)if(a[n].time<=t)return a[n]};var l=function(t){this.style("fill",s[t.action]||"FFFF09").style("stroke",s[t.action]||"FFFF09")};t.chartMeta={rangeChoices:[{label:"30 Minutes",value:1800},{label:"1 Hour",value:3600},{label:"2 Hours",value:7200},{label:"3 Hours",value:10800},{label:"4 Hours",value:14400}],start:0,duration:3600,data:[],valuesName:"actionLog",formatter:l,callback:function(a){t.chart=a},tooltip:function(a){var o=t.$new();return o.data=a,n(i.get("template/loadTooltip.html"))(o)},margin:{left:125}},t.meta={tonnes:2500},t.actionKey=[{label:"Loading",color:s[r.LOADING]},{label:"Waiting",color:s[r.WAIT]},{label:"Field Travel",color:s[r.FIELD_EMPTY]},{label:"Road Travel",color:s[r.ROAD_EMPTY]},{label:"Unload",color:s[r.UNLOAD]}]}])}(),angular.module("trucksim").directive("json",function(){return{restrict:"A",require:"ngModel",link:function(t,a,n,i){function o(t){return t&&""!==t.trim()?angular.fromJson(t):{}}function r(t){return angular.toJson(t,!0)}i.$parsers.push(o),i.$formatters.push(r),t.$watch(n.ngModel,function(t,a){t!=a&&(i.$setViewValue(r(t)),i.$render())},!0)}}}),angular.module("trucksim").filter("toMinutes",function(){return function(t){var a=t%60,n=(t-a)/60;return a=("0"+a.toString()).slice(-2),n.toString()+":"+a}}).filter("secondsToDateTime",function(){return function(t){return new Date(1970,0,1).setSeconds(t)}}).filter("percent",function(){return function(t,a){return angular.isUndefined(a)&&(a=0),(100*t).toFixed(a).toString()+"%"}}),angular.module("trucksim").constant("field48",'{"41":[{"action":"road1","start":996.0,"duration":862.0},{"action":"wait","start":1858.0,"duration":55.0},{"action":"field_travel1","start":1913.0,"duration":15.0},{"action":"wait","start":1928.0,"duration":18.0},{"action":"loading","start":1946.0,"duration":71.0},{"action":"wait","start":2017.0,"duration":8.0},{"action":"loading","start":2025.0,"duration":404.0},{"action":"wait","start":2429.0,"duration":6.0},{"action":"loading","start":2435.0,"duration":92.0},{"action":"wait","start":2527.0,"duration":57.0},{"action":"field_travel1","start":2584.0,"duration":52.0},{"action":"wait","start":2636.0,"duration":52.0},{"action":"field_travel1","start":2688.0,"duration":7.0},{"action":"road1","start":2695.0,"duration":1024.0},{"action":"taxi","start":3719.0,"duration":17.0},{"action":"scale","start":3736.0,"duration":18.0},{"action":"taxi","start":3754.0,"duration":56.0},{"action":"unload","start":3810.0,"duration":6.0},{"action":"taxi","start":3816.0,"duration":86.0},{"action":"unload","start":3902.0,"duration":146.0},{"action":"taxi","start":4048.0,"duration":146.0},{"action":"unload","start":4194.0,"duration":52.0},{"action":"taxi","start":4246.0,"duration":64.0},{"action":"road1","start":4310.0,"duration":867.0},{"action":"field_travel1","start":5177.0,"duration":66.0},{"action":"loading","start":5243.0,"duration":580.0},{"action":"wait","start":5823.0,"duration":16.0},{"action":"field_travel1","start":5839.0,"duration":56.0},{"action":"road1","start":5895.0,"duration":1057.0},{"action":"taxi","start":6952.0,"duration":27.0},{"action":"scale","start":6979.0,"duration":10.0},{"action":"taxi","start":6989.0,"duration":54.0},{"action":"unload","start":7043.0,"duration":48.0},{"action":"taxi","start":7091.0,"duration":29.0},{"action":"unload","start":7120.0,"duration":7.0},{"action":"taxi","start":7127.0,"duration":6.0},{"action":"unload","start":7133.0,"duration":183.0},{"action":"taxi","start":7316.0,"duration":51.0},{"action":"scale","start":7367.0,"duration":6.0},{"action":"taxi","start":7373.0,"duration":10.0}],"42":[{"action":"road1","start":364.0,"duration":830.0},{"action":"field_travel1","start":1194.0,"duration":23.0},{"action":"loading","start":1217.0,"duration":171.0},{"action":"road1","start":1388.0,"duration":16.0},{"action":"loading","start":1404.0,"duration":165.0},{"action":"wait","start":1569.0,"duration":1.0},{"action":"loading","start":1570.0,"duration":100.0},{"action":"wait","start":1670.0,"duration":13.0},{"action":"loading","start":1683.0,"duration":41.0},{"action":"wait","start":1724.0,"duration":16.0},{"action":"loading","start":1740.0,"duration":12.0},{"action":"wait","start":1752.0,"duration":122.0},{"action":"loading","start":1874.0,"duration":82.0},{"action":"wait","start":1956.0,"duration":61.0},{"action":"field_travel1","start":2017.0,"duration":53.0},{"action":"road1","start":2070.0,"duration":1125.0},{"action":"taxi","start":3195.0,"duration":10.0},{"action":"scale","start":3205.0,"duration":90.0},{"action":"taxi","start":3295.0,"duration":64.0},{"action":"unload","start":3359.0,"duration":19.0},{"action":"taxi","start":3378.0,"duration":15.0},{"action":"unload","start":3393.0,"duration":147.0},{"action":"taxi","start":3540.0,"duration":61.0},{"action":"road1","start":3601.0,"duration":893.0},{"action":"field_travel1","start":4494.0,"duration":57.0},{"action":"loading","start":4551.0,"duration":363.0},{"action":"wait","start":4914.0,"duration":9.0},{"action":"loading","start":4923.0,"duration":270.0},{"action":"field_travel1","start":5193.0,"duration":82.0},{"action":"road1","start":5275.0,"duration":1361.0},{"action":"taxi","start":6636.0,"duration":20.0},{"action":"scale","start":6656.0,"duration":20.0},{"action":"taxi","start":6676.0,"duration":59.0},{"action":"unload","start":6735.0,"duration":6.0},{"action":"taxi","start":6741.0,"duration":23.0},{"action":"unload","start":6764.0,"duration":13.0},{"action":"taxi","start":6777.0,"duration":7.0},{"action":"unload","start":6784.0,"duration":195.0},{"action":"taxi","start":6979.0,"duration":71.0},{"action":"scale","start":7050.0,"duration":5.0},{"action":"taxi","start":7055.0,"duration":10.0}],"43":[{"action":"loading","start":294.0,"duration":534.0},{"action":"wait","start":828.0,"duration":7.0},{"action":"loading","start":835.0,"duration":17.0},{"action":"wait","start":852.0,"duration":12.0},{"action":"loading","start":864.0,"duration":16.0},{"action":"wait","start":880.0,"duration":23.0},{"action":"loading","start":903.0,"duration":92.0},{"action":"field_travel1","start":995.0,"duration":159.0},{"action":"loading","start":1154.0,"duration":23.0},{"action":"wait","start":1177.0,"duration":12.0},{"action":"field_travel1","start":1189.0,"duration":2.0},{"action":"road1","start":1191.0,"duration":1385.0},{"action":"taxi","start":2576.0,"duration":22.0},{"action":"scale","start":2598.0,"duration":41.0},{"action":"taxi","start":2639.0,"duration":88.0},{"action":"unload","start":2727.0,"duration":8.0},{"action":"taxi","start":2735.0,"duration":9.0},{"action":"unload","start":2744.0,"duration":140.0},{"action":"taxi","start":2884.0,"duration":58.0},{"action":"road1","start":2942.0,"duration":958.0},{"action":"field_travel1","start":3900.0,"duration":40.0},{"action":"loading","start":3940.0,"duration":574.0},{"action":"field_travel1","start":4514.0,"duration":25.0},{"action":"loading","start":4539.0,"duration":12.0},{"action":"wait","start":4551.0,"duration":17.0},{"action":"field_travel1","start":4568.0,"duration":56.0},{"action":"road1","start":4624.0,"duration":1329.0},{"action":"taxi","start":5953.0,"duration":6.0},{"action":"scale","start":5959.0,"duration":6.0},{"action":"taxi","start":5965.0,"duration":22.0},{"action":"scale","start":5987.0,"duration":19.0},{"action":"taxi","start":6006.0,"duration":74.0},{"action":"unload","start":6080.0,"duration":6.0},{"action":"taxi","start":6086.0,"duration":9.0},{"action":"unload","start":6095.0,"duration":179.0},{"action":"taxi","start":6274.0,"duration":51.0}],"harvester":[{"action":"wait","start":0.0,"duration":16.0},{"action":"loading","start":16.0,"duration":6.0},{"action":"idle","start":22.0,"duration":45.0},{"action":"loading","start":67.0,"duration":9.0},{"action":"idle","start":76.0,"duration":213.0},{"action":"loading","start":289.0,"duration":540.0},{"action":"idle","start":829.0,"duration":6.0},{"action":"loading","start":835.0,"duration":45.0},{"action":"idle","start":880.0,"duration":7.0},{"action":"loading","start":887.0,"duration":155.0},{"action":"wait","start":1042.0,"duration":112.0},{"action":"loading","start":1154.0,"duration":238.0},{"action":"wait","start":1392.0,"duration":5.0},{"action":"loading","start":1397.0,"duration":283.0},{"action":"idle","start":1680.0,"duration":2.0},{"action":"loading","start":1682.0,"duration":42.0},{"action":"idle","start":1724.0,"duration":16.0},{"action":"loading","start":1740.0,"duration":12.0},{"action":"idle","start":1752.0,"duration":87.0},{"action":"loading","start":1839.0,"duration":29.0},{"action":"idle","start":1868.0,"duration":6.0},{"action":"loading","start":1874.0,"duration":150.0},{"action":"idle","start":2024.0,"duration":3.0},{"action":"loading","start":2027.0,"duration":428.0},{"action":"unknown","start":2455.0,"duration":1.0},{"action":"loading","start":2456.0,"duration":231.0},{"action":"idle","start":2687.0,"duration":1.0},{"action":"loading","start":2688.0,"duration":358.0},{"action":"wait","start":3046.0,"duration":12.0},{"action":"loading","start":3058.0,"duration":29.0},{"action":"wait","start":3087.0,"duration":853.0},{"action":"loading","start":3940.0,"duration":574.0},{"action":"wait","start":4514.0,"duration":25.0},{"action":"loading","start":4539.0,"duration":654.0},{"action":"wait","start":5193.0,"duration":50.0},{"action":"loading","start":5243.0,"duration":943.0},{"action":"idle","start":6186.0,"duration":13.0},{"action":"loading","start":6199.0,"duration":51.0},{"action":"wait","start":6250.0,"duration":1.0},{"action":"idle","start":6251.0,"duration":196.0},{"action":"loading","start":6447.0,"duration":126.0},{"action":"idle","start":6573.0,"duration":30.0},{"action":"loading","start":6603.0,"duration":62.0},{"action":"wait","start":6665.0,"duration":21.0},{"action":"loading","start":6686.0,"duration":24.0},{"action":"idle","start":6710.0,"duration":56.0},{"action":"loading","start":6766.0,"duration":15.0},{"action":"idle","start":6781.0,"duration":17.0},{"action":"loading","start":6798.0,"duration":19.0},{"action":"idle","start":6817.0,"duration":821.0},{"action":"loading","start":7638.0,"duration":17.0},{"action":"unknown","start":7655.0,"duration":0.0}],"39":[{"action":"road1","start":1012.0,"duration":940.0},{"action":"field_travel1","start":1952.0,"duration":50.0},{"action":"wait","start":2002.0,"duration":218.0},{"action":"field_travel1","start":2220.0,"duration":49.0},{"action":"wait","start":2269.0,"duration":4.0},{"action":"field_travel1","start":2273.0,"duration":8.0},{"action":"wait","start":2281.0,"duration":12.0},{"action":"field_travel1","start":2293.0,"duration":8.0},{"action":"wait","start":2301.0,"duration":96.0},{"action":"field_travel1","start":2397.0,"duration":3.0},{"action":"wait","start":2400.0,"duration":121.0},{"action":"loading","start":2521.0,"duration":1.0},{"action":"wait","start":2522.0,"duration":1.0},{"action":"loading","start":2523.0,"duration":410.0},{"action":"wait","start":2933.0,"duration":3.0},{"action":"loading","start":2936.0,"duration":110.0},{"action":"field_travel1","start":3046.0,"duration":12.0},{"action":"loading","start":3058.0,"duration":29.0},{"action":"field_travel1","start":3087.0,"duration":23.0},{"action":"road1","start":3110.0,"duration":1253.0},{"action":"taxi","start":4363.0,"duration":17.0},{"action":"scale","start":4380.0,"duration":8.0},{"action":"taxi","start":4388.0,"duration":59.0},{"action":"unload","start":4447.0,"duration":43.0},{"action":"taxi","start":4490.0,"duration":37.0},{"action":"unload","start":4527.0,"duration":149.0},{"action":"taxi","start":4676.0,"duration":44.0},{"action":"road1","start":4720.0,"duration":971.0},{"action":"field_travel1","start":5691.0,"duration":77.0},{"action":"wait","start":5768.0,"duration":55.0},{"action":"loading","start":5823.0,"duration":267.0},{"action":"wait","start":6090.0,"duration":13.0},{"action":"loading","start":6103.0,"duration":80.0},{"action":"wait","start":6183.0,"duration":16.0},{"action":"loading","start":6199.0,"duration":51.0},{"action":"field_travel1","start":6250.0,"duration":1.0},{"action":"wait","start":6251.0,"duration":197.0},{"action":"loading","start":6448.0,"duration":124.0},{"action":"wait","start":6572.0,"duration":34.0},{"action":"loading","start":6606.0,"duration":59.0},{"action":"field_travel1","start":6665.0,"duration":21.0},{"action":"loading","start":6686.0,"duration":5.0},{"action":"field_travel1","start":6691.0,"duration":4.0},{"action":"loading","start":6695.0,"duration":2.0},{"action":"wait","start":6697.0,"duration":941.0},{"action":"loading","start":7638.0,"duration":12.0},{"action":"wait","start":7650.0,"duration":1.0},{"action":"loading","start":7651.0,"duration":30.0},{"action":"road1","start":7681.0,"duration":1483.0},{"action":"taxi","start":9164.0,"duration":15.0},{"action":"scale","start":9179.0,"duration":33.0},{"action":"taxi","start":9212.0,"duration":76.0},{"action":"unload","start":9288.0,"duration":133.0},{"action":"taxi","start":9421.0,"duration":70.0},{"action":"scale","start":9491.0,"duration":9.0},{"action":"taxi","start":9500.0,"duration":13.0}]}'),angular.module("trucksim").directive("timeChart",["$timeout","d3","$compile",function(t,a,n){var i;return{restrict:"EA",scope:{options:"="},controller:["$scope",function(o){var r=a.time.format("%H:%M"),e=function(t){return r(new Date(2e3,1,1,0,0,t))},c=[];o.drawAxes=function(t){var n=a.svg.axis().scale(t.x).orient("bottom").tickFormat(e),i=a.svg.axis().scale(t.y).orient("left").tickFormat(function(t){return o.options.data[t].label}),r=o.dimensions;o.canvas=o.svg.attr("height",r.height).attr("width",r.width).append("g").attr("transform","translate("+r.margin.left+","+r.margin.top+")"),o.svg.append("g").attr("transform","translate("+r.margin.left+","+(r.height-r.margin.top-r.margin.bottom)+")").attr("fill","none").attr("stroke","#000").attr("shape-rendering","crispEdges").call(n),o.svg.append("g").attr("transform","translate("+r.margin.left+","+-r.margin.top+")").attr("fill","none").attr("stroke","#000").attr("shape-rendering","crispEdges").call(i),c=[],o.options.data.forEach(function(a,n){c[n]=o.canvas.append("g").attr("transform","translate(0,"+(t.y(n)-r.fullRowHeight/2-r.gutter)+")")})};var s;o.drawValue=function(a,r,e){var d,u,l=o.dimensions.scales.x.domain()[0];if(!(r.start+r.duration<l||r.start>o.dimensions.scales.x.domain()[1])){r.start<l?(d=l,u=r.duration-(l-r.start)):(d=r.start,u=r.duration);var f=c[a].append("rect").attr("x",o.dimensions.scales.x(d)).attr("width",o.dimensions.scales.x(u+o.options.start)).attr("height",o.dimensions.barHeight).style("stoke-opacity",1).style("fill-opacity",.75).on("mouseover",function(a){if(angular.isDefined(s))return void(r!==s&&o.hideTooltip());var c=o.$new();c.data=r,c.actionLog=e.actionLog,i.html(o.options.tooltip.call(this,r,c)),t(function(){n(angular.element(i[0][0]).contents())(c)}),i.transition().duration(200).style("opacity",.9),i.style("top",event.pageY-10+"px").style("left",event.pageX+10+"px")}).on("click",function(){return i.style("top",event.pageY+"px").style("left",event.pageX+"px")}).on("mousedown",function(t){s=r}).on("mouseup",function(t){angular.isDefined(o.options.dragFn)&&o.options.dragFn.call(e.actionLog,s,r),s=void 0}).on("mouseout",function(){return i.transition().duration(200).style("opacity",0)});angular.isDefined(o.options.formatter)&&o.options.formatter.call(f,r)}},o.drawData=function(){o.options.data.forEach(function(t,a){t[o.options.valuesName||"values"].forEach(function(n){o.drawValue(a,n,t)})})},o.getScales=function(){var t={},n=o.dimensions,i=o.options.data||[],r=[],e=[];n.fullRowHeight=n.innerHeight/(i.length||1),n.gutter=.1*n.fullRowHeight,n.barHeight=n.fullRowHeight-n.gutter;for(var c=0;c<o.options.data.length;c++)r.push(c),e.push(c*n.fullRowHeight+n.barHeight/2);return t.y=a.scale.ordinal().domain(r).range(e.reverse()),t.x=a.time.scale.utc().domain([o.options.start||0,(parseInt(o.options.start)||0)+(parseInt(o.options.duration)||3600)]).range([0,n.width-n.margin.left-n.margin.right]),n.scales=t,t},o.hideTooltip=function(){return i.transition().duration(200).style("opacity",0)}}],link:function(t,n,o){t.dimensions={},t.dimensions.margin=angular.extend({top:10,right:30,bottom:30,left:75},t.options.margin);var r=n[0];t.resize=function(){var a=t.dimensions;a.height=r.offsetHeight,a.width=r.offsetWidth,a.innerHeight=a.height-a.margin.top-a.margin.bottom,a.innerWidth=a.width-a.margin.left-a.margin.right},t.resize(),t.svg=a.select(r).append("svg"),a.select("body>.tooltip").remove(),i=a.select("body").append("div").attr("class","tooltip").style("background","#FFF").style("border-radius","4px").style("padding-left","10px").style("opacity",0),t.refresh=function(){t.svg.selectAll("*").remove(),t.resize(),t.drawAxes(t.getScales()),t.drawData()},t.refresh(),angular.isDefined(t.options.callback)&&t.options.callback.call(t.svg,t)}}}]),angular.module("trucksim").directive("jsonClipboard",["$log",function(t){return{restrict:"A",link:function(a,n,i){var o=new Clipboard(n[0],{text:function(t){return a.observe.copyData={},a.chartMeta.data.forEach(function(t){a.observe.copyData[t.machine]=t.actionLog}),angular.toJson(a.observe.copyData,!0)}});o.on("success",function(a){t.debug(a)}),o.on("error",function(a){t.debug(a)})}}}]),angular.module("trucksim").factory("defaultChartOptions",["d3","$templateCache","$rootScope","$interpolate",function(t,a,n,i){function o(t){var a=new Date(1970,0,1);return a.setSeconds(t),r(a)}var r=t.time.format("%H:%M:%S");return{chart:{type:"multiBarHorizontalChart",noData:"Loading chart...",height:450,showLegend:!1,showControls:!1,tooltip:{contentGenerator:function(t){var o=n.$new();return o.data=t.data,o.point=t,i(a.get("template/loadTooltip.html"))(o)}},margin:{top:20,right:20,bottom:45,left:45},clipEdge:!0,duration:10,stacked:!0,xAxis:{axisLabel:"Machine",showMaxMin:!1,tickFormat:function(t){return 0===t?"Harvester":"Truck "+t.toString()}},yAxis:{axisLabel:"Time",axisLabelDistance:0,scale:21600,ticks:6,tickFormat:o}}}}]).factory("buildRectangle",function(){return function(t){return[t,{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h},{x:t.x,y:t.y+t.h}]}}),function(){"use strict";angular.module("trucksim").constant("malarkey",malarkey).constant("moment",moment).constant("d3",d3)}();
//# sourceMappingURL=../maps/scripts/app-cea35273a2.js.map
